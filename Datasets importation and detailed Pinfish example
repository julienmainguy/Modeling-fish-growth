library(fishmethods)
library(FSA)
library(FSAdata)
library(nlraa)
library(nlstools)
library(scam)

## The importation of any but one of the 21 publicly-available datasets presented in Table 1 of the main text
## can be directly achieved once the "fishmethod" and "FSAdata" packages have been activated in R. Note that
## additional steps to remove some sampled fish may be required, which is the case for the three detailed examples
## presented in the main text (1) pinfish, (2) male black drums, and (3) female haddocks. Given that these three
## datasets are presented in more details, here are the additional code that were applied applied:

## Example 1: pinfish (Nelson 2002)

## The original pinfish dataset, the only linked to the "fishmethod" package (Nelson 2025), has 670 sampled males 
## and females, as can be confirmed from using the headtail() function of the "FSA" package which shows the first
## and last three lines of this dataset.

headtail(pinfish)


## As indicated in Nelson (2002) and the related Fig. 4B presented in this study, both sexes were combined and with the
## analyses only conducted for pinfish exhibiting a standard length (sl) of 66 mm and greater, up to the maximum of 255 mm.
## The pinfish dataset was thus first reduced by excluding small individual fish with sl < 66 mm.

pinfish <- pinfish[which(pinfish$sl > 65),]


## The descriptive statistics of this reduced dataset, as obtained with the Summarize() function of "FSA", now indicate that
## n = 665 pinfish exhibiting an sl varying between 66 and 255 mm are considered. Note that Nelson (2002) reports using n = 658
## pinfish in his analyses, such that 7 additional individual fish were considered here.

Summarize(sl ~ 1, data = pinfish)


## Example 2: male black drums (Ogle 2016)

## This example is originally used in the excellent fisheries-related textbook of Ogle (2016, Chapter 12) to show the detailed
## application of the von Bertalanffy growth model (VBGM) in which only the males from the BlackDrum2001 dataset found in "FSAdata"
## are used. As a first step only the males are kept and, as done by Ogle (2016), a 51-year-old (oldest) male is also removed,
## leaving a total of 74 males aged between 3 and 42 years old. To be consistent with Ogle (2016), the reduced data is referred to
## as "bdm" for black drum males.

bdm <- BlackDrum2001 [which(BlackDrum2001$sex == "male"),]
bdm <- bdm[which(bdm$otoage < 51),]
Summarize(otoage ~ 1, data = bdm)


## Example 3: female haddocks (Honsey et al. 2017)

## This is the only dataset that needs to be first downloaded from Dryad: https://datadryad.org/dataset/doi:10.5061/dryad.vb957
## But to facilitate the importation of this dataset into R, the same dataset has been made available here in a .txt format
## in which *Season = SPRING*, *Year = 2015*, and *Sex = 2* (i.e., female), corresponding to an information that is common to all
## sampled female haddocks, has been removed. This modified dataset can be automatically imported into R from using the following
## url link together with the read.delim() function.

url <- "https://raw.githubusercontent.com/julienmainguy/Modeling-fish-growth/refs/heads/main/haddock.txt"
haddock <- read.delim(url)


## However, and as done in the two previous examples, this dataset was further reduced by Honsey et al. (2017) by discarding the 
## two smallest females despite the fact that these two observations did not appear to act as outliers, but could have had a
## leverage on the linear relationship describing the first phase of the biphasic growth model and could thus possibly having been
## removed for such reason. Regardless of the reason behind their removal, the original dataset was reduced to n = 359 by containing
## haddock females exhibiting a total lenght (tl) of 20 cm or more.

haddock <- haddock[which(haddock$TotalLength >= 20),]
Summarize(Age ~ 1, data = haddock)


## In the other 17 examples, the removal of NA's needed to be performed prior to analyze the length-at-age data, such as in the
## RuffeSLRH92 data with n = 738 sampled fish of which only 12 had their age identified, as indicated from using the Summarize()
## function of FSA, sucht that all the sampled fish with NA's for the variable age only were removed.

Summarize(age ~ 1, data = RuffeSLRH92)
RuffeSLRH92 <- RuffeSLRH92[!is.na(RuffeSLRH92$age),]
Summarize(age ~ 1, data = RuffeSLRH92)



